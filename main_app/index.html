<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EMI Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      background: #121212;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 0;
    }
    nav {
      display: flex;
      gap: 15px;
      background: #1f1f1f;
      padding: 10px;
      flex-wrap: wrap;
    }
    nav a {
      color: #fff;
      background: #333;
      padding: 8px 15px;
      border-radius: 5px;
      text-decoration: none;
    }
    nav a:hover {
      background: #00bcd4;
      color: #000;
    }
    main {
      padding: 20px;
    }
    h1 {
      color: #00bcd4;
    }
    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      margin: 20px 0;
    }
    .card {
      background: #1e1e1e;
      padding: 20px;
      border-radius: 6px;
      flex: 1 1 200px;
    }
    canvas {
      margin-top: 30px;
      background: #1a1a1a;
      padding: 10px;
      border-radius: 6px;
    }
    input[type="file"] {
      margin-top: 10px;
      background: #1d1d1d;
      color: white;
      padding: 10px;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Dashboard</a>
    <a href="customers.html">Customers</a>
    <a href="entries.html">Entries</a>
    <a href="review.html">Agent Review</a>
    <a href="report.html">Reports</a>
  </nav>

  <main>
    <h1>Dashboard</h1>

    <input type="file" accept=".json" onchange="loadJSON(event)" />

    <div class="summary">
      <div class="card">
        <h3>Total Customers</h3>
        <p id="totalCustomers">-</p>
      </div>
      <div class="card">
        <h3>Total Products</h3>
        <p id="totalProducts">-</p>
      </div>
      <div class="card">
        <h3>Total Paid</h3>
        <p id="totalPaid">-</p>
      </div>
      <div class="card">
        <h3>Total Balance</h3>
        <p id="totalBalance">-</p>
      </div>
    </div>

    <canvas id="barChart" width="400" height="200"></canvas>
    <canvas id="pieChart" width="400" height="200"></canvas>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let customersData = [];

    function loadJSON(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        customersData = JSON.parse(e.target.result);
        updateDashboard();
      };
      reader.readAsText(file);
    }

    function updateDashboard() {
      const totalCustomers = customersData.length;
      let totalProducts = 0;
      let totalPaid = 0;
      let totalBalance = 0;

      customersData.forEach(customer => {
        customer.products.forEach(product => {
          totalProducts++;
          totalPaid += product.paid;
          totalBalance += (product.total - product.paid);
        });
      });

      document.getElementById("totalCustomers").textContent = totalCustomers;
      document.getElementById("totalProducts").textContent = totalProducts;
      document.getElementById("totalPaid").textContent = "₹" + totalPaid.toFixed(2);
      document.getElementById("totalBalance").textContent = "₹" + totalBalance.toFixed(2);

      drawCharts(totalPaid, totalBalance);
    }

    function drawCharts(paid, balance) {
      const barCtx = document.getElementById("barChart").getContext("2d");
      const pieCtx = document.getElementById("pieChart").getContext("2d");

      new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: ['Paid', 'Balance'],
          datasets: [{
            label: 'Collection Status',
            data: [paid, balance],
            backgroundColor: ['#4caf50', '#f44336']
          }]
        }
      });

      new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: ['Paid', 'Balance'],
          datasets: [{
            data: [paid, balance],
            backgroundColor: ['#4caf50', '#f44336']
          }]
        }
      });
    }
  </script>
</body>
</html>
